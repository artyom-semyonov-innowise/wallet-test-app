# Mobile Wallet - Test Assignment Implementation

Это приложение реализует безопасный мобильный кошелек с нативной криптографией для подписания транзакций.

## Основные функции

✅ **Нативный модуль Android** - криптографические операции выполняются в нативном слое  
✅ **Android Keystore** - приватный ключ хранится в защищенном хранилище и никогда не покидает его  
✅ **Подпись транзакций** - транзакции подписываются нативно, только подпись возвращается в JS  
✅ **Replay Protection** - защита от повторной отправки через валидацию nonce  
✅ **Mock Backend** - имитация бэкенда для демонстрации работы  
✅ **Документация** - подробная документация по безопасности и дизайну

## Структура проекта

```
android/app/src/main/java/com/wallettest/wallet/
  ├── WalletKeyManager.kt      # Управление ключами в Android Keystore
  ├── TransactionSigner.kt     # Подпись транзакций и replay protection
  ├── WalletModule.kt          # React Native мост
  ├── WalletPackage.kt         # Регистрация модуля
  └── WalletException.kt       # Кастомные исключения

src/
  ├── wallet.ts                # JS обертка над нативным модулем
  ├── types.ts                 # TypeScript типы
  ├── components/
  │   └── WalletApp.tsx        # UI приложения
  └── services/
      └── mockBackend.ts       # Mock backend сервис

docs/
  ├── THREAT_MODEL.md          # Модель угроз
  ├── TRADE_OFFS.md            # Компромиссы и решения
  └── PRODUCTION.md            # Рекомендации для продакшена
```

## Требования

- React Native 0.83.1
- Android API 24+ (Android 7.0+)
- Kotlin 2.1.20
- Node.js >= 20

## Установка и запуск

1. Установите зависимости:
```bash
npm install
```

2. Для Android:
```bash
npm run android
```

## Как использовать

1. **Генерация ключевой пары**:
   - Нажмите "Generate Key Pair"
   - Приватный ключ будет создан в Android Keystore
   - Публичный ключ отобразится в интерфейсе

2. **Создание транзакции**:
   - Введите amount (сумму)
   - Введите currency (валюту)
   - Укажите nonce (должен быть больше предыдущего)

3. **Подпись и отправка**:
   - Нажмите "Sign & Send Transaction"
   - Транзакция будет подписана нативно (приватный ключ не покидает Keystore)
   - Подпись отправляется в mock backend
   - При успехе nonce автоматически увеличивается

## Безопасность

### Ключевые особенности безопасности:

1. **Приватный ключ никогда не покидает Android Keystore**
   - Все криптографические операции выполняются в нативном слое
   - JavaScript слой получает только публичный ключ и подпись

2. **Replay Protection**
   - Каждая транзакция требует уникальный возрастающий nonce
   - Последний использованный nonce хранится локально
   - Валидация nonce выполняется перед подписанием
   - Mock backend также проверяет nonce

3. **Канонический формат транзакций**
   - Транзакции форматируются в детерминированный формат перед подписанием
   - Формат: `amount|currency|nonce`
   - Предотвращает проблемы с malleability подписей

### Технические детали:

- **Алгоритм**: ECDSA с кривой secp256r1 (P-256)
- **Хэширование**: SHA-256
- **Хранилище ключей**: Android Keystore System
- **Подпись**: Base64-encoded ECDSA signature

## Документация

Подробная документация находится в папке `docs/`:

- **THREAT_MODEL.md** - Анализ угроз и меры защиты
- **TRADE_OFFS.md** - Компромиссы и обоснование решений
- **PRODUCTION.md** - Рекомендации для продакшена

## Ограничения тестовой версии

⚠️ **Важно для production**: Эта версия предназначена для демонстрации концепции. Для продакшена необходимо:

- Реализовать криптографическую верификацию подписей на бэкенде
- Добавить HTTPS/TLS с certificate pinning
- Добавить биометрическую аутентификацию для подписания
- Реализовать детекцию root/jailbreak
- Добавить code obfuscation
- Реализовать ключевые улучшения из PRODUCTION.md

## Тестирование

### Тест Replay Protection:

1. Создайте транзакцию с nonce = 1, подпишите и отправьте
2. Попробуйте создать транзакцию с nonce = 1 снова
3. Должна появиться ошибка: "Invalid nonce: 1. Must be greater than last used nonce: 1"

### Тест валидации nonce:

1. Создайте транзакцию с nonce = 5
2. Затем попробуйте создать транзакцию с nonce = 3
3. Должна появиться ошибка валидации nonce

## Лицензия

Тестовое задание
